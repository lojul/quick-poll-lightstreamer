version: "3.8"

services:
  lightstreamer:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
    restart: unless-stopped

  # Standalone adapter process (for development)
  poll-adapter:
    build:
      context: ./adapters/poll-adapter
      dockerfile: Dockerfile.dev
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - LS_REQUEST_PORT=6661
      - LS_NOTIFY_PORT=6662
    depends_on:
      - lightstreamer
    restart: unless-stopped
